<!DOCTYPE html>
<html>
  <head>
    <title>Qubit Quarry</title>
    <link rel="icon" type="image/x-icon" href="/Data/Images/favicon.png" />
  </head>

  <body>
    <p id="userDisplay"></p>
    <div>
      <shop style="float: left; width: 30%; text-align: center; height: 100%">
        <h3>Upgrade Shop</h3>
        <ul style="list-style-type: none" id="upgradeShop">
          <li>Test <button>Buy!</button></li>
          <li>Test <button>Buy!</button></li>
        </ul>
      </shop>
      <div style="float: left; width: 40%">
        <button onclick="calculatePoints()">
          <img
            id="cubeImage"
            src="/Data/Images/cubeStageOne.png"
            style="
              display: block;
              margin-left: auto;
              margin-right: auto;
              max-width: 100%;
            "
          />
        </button>
        <p id="pointDisplay" style="text-align: center"></p>
      </div>

      <inventory
        style="float: left; width: 30%; text-align: center; height: 100%"
      >
        <h3>Inventory</h3>
        <ul style="list-style-type: none; height: 100%" id="upgradeShop">
          <li>Test</li>
          <li>Test</li>
        </ul>
      </inventory>
    </div>
    <script>
      function obtainUserID() {
        const parameters = new URLSearchParams(window.location.search);
        console.log(`Current userID: ${parameters.get("user")}`);
        return parameters.get("user");
      }

      const userID = obtainUserID();
      var currentPoints = 0;
      var miningValue = 0;
      var miningPassive = 0;

      function textUpdate() {
        const userDisplay = document.getElementById("userDisplay");
        userDisplay.innerText = `You are user ${userID}`;
        const pointDisplay = document.getElementById("pointDisplay");
        pointDisplay.innerText = `Current Points: ${currentPoints}`;
      }
      textUpdate();
      function fetchUpgrades() {
        // Fetch from backend
        let upgradeArray = [
          // This will be replaced by the fetch
          { Name: "Steel Pickaxe", Effect: "ADD", Value: 5 },
          { Name: "Electric Lantern", Effect: "MULTIPLY", Value: 2 },
          { Name: "Gnome Assistants", Effect: "PASSIVE", Value: 1 },
          { Name: "Good Meal", Effect: "EXPONENT", Value: 1 },
        ];

        miningValue = 0;
        miningPassive = 0;
        var miningAddition = 0;
        var miningMultiply = 1;
        var miningExponent = 1;

        for (let i = 0; i < upgradeArray.length; i++) {
          if (upgradeArray[i].Effect === "ADD") {
            miningAddition += upgradeArray[i].Value;
          } else if (upgradeArray[i].Effect === "MULTIPLY") {
            miningMultiply += upgradeArray[i].Value;
          } else if (upgradeArray[i].Effect === "EXPONENT") {
            miningExponent += upgradeArray[i].Value;
          } else if (upgradeArray[i].Effect === "PASSIVE") {
            miningPassive += upgradeArray[i].Value;
          } else {
            alert(
              `Invalid upgrade effect: ${upgradeArray[i].Effect} from ${upgradeArray[i].Name} upgrade`
            );
          }
        }
        console.log(
          `Addition: ${miningAddition}, Exponent: ${miningExponent}, Multiplier: ${miningMultiply}, Passive: ${miningPassive}`
        );
        miningValue = miningAddition ** miningExponent * miningMultiply;
      }

      function calculatePoints() {
        fetchUpgrades();
        var timeSinceLastClick = 60; // Time in seconds since the last click
        currentPoints += miningValue + miningPassive * timeSinceLastClick;
        console.log(`Current points: ${currentPoints}`);
        textUpdate();
      }

      function regularFetch() {
        console.log("A fetch would have been executed right now!");
        // This function will send a POST request every few seconds to update the USERS table
      }
      setInterval(regularFetch, 5000);
    </script>
  </body>
</html>
