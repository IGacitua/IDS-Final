<!DOCTYPE html>
<html>
  <head>
    <title>Qubit Quarry</title>
    <link rel="icon" type="image/x-icon" href="/Data/Images/favicon.png" />
  </head>

  <body>
    <div>
      <shop style="float: left; width: 30%; text-align: center; height: 100%">
        <h3>Upgrade Shop</h3>
        <ul style="list-style-type: none" id="upgradeShop"></ul>
      </shop>
      <div style="float: left; width: 40%">
        <button onclick="fetchUserUpgrades(currentValues)">
          <img
            id="cubeImage"
            src="/Data/Images/cubeStageOne.png"
            style="
              display: block;
              margin-left: auto;
              margin-right: auto;
              max-width: 100%;
            "
          />
        </button>
        <p id="pointDisplay" style="text-align: center"></p>
      </div>

      <inventory
        style="float: left; width: 30%; text-align: center; height: 100%"
      >
        <h3>Inventory</h3>
        <ul
          style="list-style-type: none; height: 100%"
          id="upgradeInventory"
        ></ul>
      </inventory>
    </div>
    <script>
      var currentValues = {
        pointsTotal: 0,
        pointsSpent: 0,
        pointsGain: 5,
        pointsPassive: 1,
      };

      function returnUser() {
        return new URLSearchParams(window.location.search).get("user");
      }

      function fetchUserUpgrades(currentValues) {
        currentValues.pointsGain = 0;
        currentValues.pointsPassive = 0;

        let all_upgrades;

        fetch(`http://localhost:5000/upgrades/`, { method: "GET" })
          .then((response) => response.json())
          .then((content) => {
            all_upgrades = content;
          });

        let miningAddition = 0;
        let miningMultiply = 1;
        let miningExponent = 1;
        let miningPassive = 0;

        fetch(`http://localhost:5000/users/${returnUser()}/upgrades/`, {
          method: "GET",
        })
          .then((response) => response.json())
          .then((content) => {
            for (let i = 0; i < all_upgrades.length; i++) {
              if (all_upgrades[i].internal_name === "pickaxe") {
                if (content.pickaxe > 0) {
                  console.log(`Pickaxe value: ${content.pickaxe}`);
                  switch (content.pickaxe) {
                    case 1: {
                      miningAddition += all_upgrades[i].value_tier_1;
                      break;
                    }
                    case 2: {
                      miningAddition += all_upgrades[i].value_tier_2;
                      break;
                    }
                    case 3: {
                      miningAddition += all_upgrades[i].value_tier_3;
                      break;
                    }
                    case 4: {
                      miningAddition += all_upgrades[i].value_tier_4;
                      break;
                    }
                    case 5: {
                      miningAddition += all_upgrades[i].value_tier_5;
                      break;
                    }
                  }
                }
              } else if (all_upgrades[i].internal_name === "lantern") {
                if (content.lantern > 0) {
                  console.log(`Lantern value: ${content.lantern}`);
                  switch (content.lantern) {
                    case 1: {
                      miningMultiply *= all_upgrades[i].value_tier_1;
                      break;
                    }
                    case 2: {
                      miningMultiply *= all_upgrades[i].value_tier_2;
                      break;
                    }
                    case 3: {
                      miningMultiply *= all_upgrades[i].value_tier_3;
                      break;
                    }
                  }
                }
              } else if (all_upgrades[i].internal_name === "assistant") {
                if (content.assistant > 0) {
                  console.log(`Assistant Value: ${content.assitant}`);
                  switch (content.assistant) {
                    case 1: {
                      miningPassive += all_upgrades[i].value_tier_1;
                      break;
                    }
                    case 2: {
                      miningPassive += all_upgrades[i].value_tier_2;
                      break;
                    }
                    case 3: {
                      miningPassive += all_upgrades[i].value_tier_3;
                      break;
                    }
                  }
                }
              } else if (all_upgrades[i].internal_name === "helmet") {
                if (content.helmet > 0) {
                  miningMultiply += all_upgrades[i].value_tier_1;
                  break;
                }
              } else if (all_upgrades[i].internal_name === "housing") {
                if (content.housing > 0) {
                  miningExponent += all_upgrades[i].value_tier_1;
                }
              } else if (all_upgrades[i].internal_name === "meals") {
                if (content.meals > 0) {
                  miningExpontent += all_upgrades[i].value_tier_1;
                }
              } else if (all_upgrades[i].internal_name === "cartographer") {
                if (content.cartographer > 0) {
                  miningMultiply *= all_upgrades[i].value_tier_1;
                }
              } else {
                console.log(`Invalid upgrade ${all_upgrades[i].internal_name}`);
              }
            }
          });
        return currentValues;
      }
    </script>
  </body>
</html>
