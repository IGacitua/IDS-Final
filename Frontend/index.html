<!DOCTYPE html>
<html>
  <head>
    <title>Qubit Quarry</title>
    <link rel="icon" type="image/x-icon" href="/Data/Images/favicon.png" />
  </head>

  <body>
    <h1 style="text-align: center; font-weight: bold">Qubit Quarry</h1>
    <h5 style="text-align: justify">
      Lore: Lorem ipsum dolor sit amet, consectetur adipiscing elit. Fusce
      efficitur augue dolor, eu vestibulum arcu egestas lacinia. Donec sed
      libero convallis, molestie arcu id, malesuada orci. Vestibulum id
      tincidunt massa, id fermentum quam. Suspendisse potenti. Maecenas ac magna
      sed ipsum mollis dictum. Vivamus enim eros, euismod nec magna sed, blandit
      laoreet purus. Donec nec ullamcorper magna. Curabitur commodo metus non
      tellus molestie ullamcorper. Pellentesque finibus convallis mi, in ornare
      dui consectetur faucibus. Nullam pharetra, massa nec posuere faucibus, est
      risus egestas mi, in congue diam lorem ut nulla.
    </h5>
    <button
      onclick="openUser()"
      style="
        text-align: center;
        font-size: 25px;
        display: flex;
        position: absolute;
        margin-left: 50%;
        padding-left: 20px;
        padding-right: 20px;
        padding-top: 5px;
        padding-bottom: 5px;
      "
    >
      Play!
    </button>

    <script>
      function openUser() {
        userInput = prompt("What is your username?");

        fetch("http://localhost:5000/users/", { method: "GET" })
          .then((response) => response.json())

          .then((content) => {
            let found = false;
            for (let i = 0; i < content.length; i++) {
              if (content[i].name === userInput) {
                found = true;
                location.href = `/play/?user=${content[i].id}`;
              }
            }

            if (!found) {
              console.log("User not found, creating new user... :)");

              const newUser = {
                name: userInput,
                total_points: 0,
                spent_points: 0,
              };
              newID = createUser(newUser);
              location.href = `/play/?user=${newID}`;
            }
          });
      }

      function createUser(newUser) {
        fetch("http://localhost:5000/users/", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(newUser),
        })
          .then(() => {
            console.log("New user created");
            fetch("http://localhost:5000/users/", { method: "GET" })
              .then((response) => response.json())
              .then((content) => {
                for (let i = 0; i < content.length; i++) {
                  if (content[i].name === userInput) {
                    return content[i].id;
                  }
                }
              });
          })
          .catch((error) => {
            console.error("Error creating user:", error);
            alert("Failed to create user");
          });
      }
    </script>
  </body>
</html>
